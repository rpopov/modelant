<?xml version="1.0"?>
<!--
 * Copyright (c) 2001,2012 Rusi Popov, MDA Tools.net
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Rusi Popov (popovr@mdatools.net) - initial implementation
 -->

<!--
  Tasks, types and macros of ModelAnt wrapping the original MDRANT task by Sun. This library provides an unified intreface to the MetaData Repository (MDR)<br/>
  Usage:<br/><br/>

   &lt;typedef resource="net/mdatools/modelant/repository/antlib.xml"/&gt;

  -->
<antlib xmlns:current="ant:current">

   <typedef resource="net/mdatools/modelant/util/antlib.xml"/>
   <typedef resource="net/mdatools/modelant/repository/protected.antlib.xml"/>

   <taskdef name="mdr"               classname="org.netbeans.mdrant.MdrTask"/>
   <taskdef name="mdr.instantiate"   classname="org.netbeans.mdrant.Instantiate"/>
   <taskdef name="mdr.delete"        classname="org.netbeans.mdrant.DeleteExtent"/>
   <taskdef name="mdr.map.java"      classname="org.netbeans.mdrant.MapJava"/>
   <taskdef name="mdr.print.extent.names"      classname="org.netbeans.mdrant.PrintExtentNames"/>
   <taskdef name="mdr.read.xmi"      classname="org.netbeans.mdrant.ReadXMI"/>
   <taskdef name="mdr.write.xmi"     classname="org.netbeans.mdrant.WriteXMI"/>

  <!--
    Creates the JMI API packages for a metamodel, creates corresponding JARs, generates JAVADOC and zips it.
    Use it to establish new metamodels like UML 1.3, UML 1.4, CWM,...
    -->
  <macrodef name="mdr.build.api">
    <attribute name="work.dir" description="the name of the working directory where to create the temporary files"/>
    <attribute name="dist.dir" description="the name of the distribution directory where to create the API files. Recommended value: $${lib}"/>
    <attribute name="metamodel.extent" description="the extent where the metametamodel is loaded and the actually this is the name of the metamodel library to build"/>
    <sequential>
      <local>
        <echo>
          Create @{metamodel.extent} JMI implementation
        </echo>

        <mkdir dir="@{work.dir}/src"/>
        <mkdir dir="@{work.dir}/classes"/>
        <mkdir dir="@{work.dir}/doc"/>

        <mdr.map.java extent="@{metamodel.extent}" dir="@{work.dir}/src"/>

        <!-- Compile the generated Model API soutce code -->
        <javac deprecation="true"
               destdir="@{work.dir}/classes"
               srcdir="@{work.dir}/src"
               classpath="${net.mdatools.modelant.repository.antlib.classpath}"/>

        <!-- API -->
        <jar jarfile="@{dist.dir}/modelant-@{metamodel.extent}-api.jar" compress="false">
          <fileset dir="@{work.dir}/classes" includes="**/*.class" />
        </jar>

        <zip zipfile="@{dist.dir}/modelant-@{metamodel.extent}-api-src.zip" compress="false">
          <fileset dir="@{work.dir}/src" includes="**/*.java" />
        </zip>

        <!--
          Document APIs
          -->
        <javadoc destdir="@{work.dir}/doc" classpath="${net.mdatools.modelant.repository.antlib.classpath}">
            <packageset dir="@{work.dir}/src" defaultexcludes="yes">
            <include name="**" />
          </packageset>
        </javadoc>
        <zip zipfile="@{dist.dir}/modelant-@{metamodel.extent}-api-doc.zip" compress="false">
          <fileset dir="@{work.dir}/doc" includes="**/*.*" />
        </zip>

        <property name="api" location="@{dist.dir}/modelant-@{metamodel.extent}-api.jar"/>
        <property name="api.src" location="@{dist.dir}/modelant-@{metamodel.extent}-api-src.jar"/>
        <property name="api.doc" location="@{dist.dir}/modelant-@{metamodel.extent}-api-doc.jar"/>
        <echo>
       Make sure the
          ${api}
          ${api.src}
          ${api.doc}
      are accessible to all applications that need them.
        </echo>

        <delete dir="@{work.dir}/src"/>
        <delete dir="@{work.dir}/classes"/>
        <delete dir="@{work.dir}/doc"/>
      </local>
    </sequential>
  </macrodef>

  <!--
    Set in net.mdatools.modelant.repository.antlib.classpath the classpath of this library
    -->
  <init/>
</antlib>